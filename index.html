<!doctype html>
<html>
<head>
	<title>Alfresco HTML5</title>
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="css/bootstrap/css/bootstrap.min.css">
	<link rel="stylesheet" href="css/fontawesome/css/font-awesome.min.css">
	<!--[if IE 7]>
	<link rel="stylesheet" href="css/fontawesome/css/font-awesome-ie7.min.css">
	<![endif]-->
	<script src="js/lib/head.load.min.js"></script>
</head>

<body id="body">

	<div class="container-fluid" style="display:none;">
		
		<div data-bind="foreach: alerts">
			<div data-bind="css: {'alert-error': error}"
				class="alert alert-block fade in">
				<button type="button" class="close"
					data-bind="click: $root.removeAlert">
					<i class="icon-remove"></i>
				</button>
				<h4 class="alert-heading" data-bind="html: header"></h4>
				<p class="alert-body" data-bind="html: text"></p>
			</div>
		</div>

		<!-- ko if: !loggedIn() -->
		<div class="row-fluid">
				
				<div class="span6 offset3 well" style="text-align:center;margin-top:1em;">
					<h1>Alfresco HTML5 Client</h1>
					<br/>
					<form >
				      <div class="input-prepend">
				        <span class="add-on"><i class="icon-user"></i></span>
				        <input type="text" data-bind="value: username, valueUpdate: 'keyup'" 
				        	autofocus placeholder="username" onkeydown="cmis.loginOnReturn(event)"/>
				      </div>
				      <div class="input-prepend">
				        <span class="add-on"><i class="icon-key"></i></span>
				        <input type="password" data-bind="value: password, valueUpdate: 'keyup'"
				         placeholder="password" onkeydown="cmis.loginOnReturn(event)" />
				      </div>
				      <br/>
				      <div class="row">
					      <div class="span3 offset3">
					      	<label class="checkbox">
						        <input type="checkbox" data-bind="checked: rememberMe" />
								Remember Me
					      	</label>
					      </div>
					      <div class="span3 offset1">
					      	<label class="checkbox">
						        <input type="checkbox" data-bind="checked: autoLogin" />
								Keep me logged in
					      	</label>
					      </div>
					  </div>
				      <hr/>
				      <a href="javascript:void(0)" id="loginButton"
				      	data-bind="css: {disabled: !username() || !password()}"
				      	onclick="if (cmis.vm.username() && cmis.vm.password()) cmis.login()"
				      	class="btn btn-primary btn-block btn-large">
				      	<i class="icon-signin"></i>&nbsp;Login
				      </a>
					</form>
				</div>
			
		</div>
		<!-- /ko -->

		<!-- ko if: loggedIn() -->
		<!-- ko if: obj -->
		<div class="row-fluid">
			<h1 class="span8" style="position:relative;">
				<a href="#">
					<img src="/share/res/themes/default/images/app-logo-48.png" alt=" " 
				style="position:absolute;" data-bind="visible: ajaxStatus()=='ok'" />
				</a>
				<i class="icon-spinner icon-spin" data-bind="visible: ajaxStatus()=='working'"
				style="position:absolute;font-size: 48px;" ></i>
				<span style="padding-left:64px" data-bind="text: obj().properties['cmis:name'].value"></span>
			</h1>
			<div class="span4 form-search">
			  <div class="input-append pull-right"  style="position:relative; top: 18px;">
			    <input type="search" class="search-query" 
			    	data-bind="value: squery, valueUpdate: 'keyup'">
			    <a href="javascript:void(0)" type="button" class="btn">
			    	<i data-bind="css: {'icon-search': !searching(), 
			    		'icon-spinner icon-spin': searching()}"
			    		class=""></i>
			    </a>
			  </div>
			</div>
		</div>

		<div class="row-fluid" data-bind="if: sresults">
			<div class="span12" id="searchresults" >
				<h3>
					<a class="pull-right" href="javascript:void(0)" onclick="cmis.vm.squery(null)">
					<i class="icon-remove"></i></a>
					<span data-bind="text: squery"></span> 
					(<span data-bind="text: sresults().numItems"></span><span data-bind="if: sresults().hasMoreItems">+</span>)
				</h3>
				<div class="span12 thumbnails"> 
					<!-- ko foreach: sresults().results -->
					<div class="thumbnail pull-left" style="height: 118px; width: 310px; margin-right: 10px; margin-bottom: 10px" >
						<a class="pull-left" data-bind="attr:{
						href: '#' + $data.properties['cmis:objectId'].value,
						style: 'margin:4px; height: 100px; width: 100px; background: url(/alfresco/service/api/node/'
						+ $data.properties['alfcmis:nodeRef'].value.replace(':/','')
						+ '/content/thumbnails/doclib?c=queue&ph=true) center no-repeat'}"
						>
						</a>
						<div style="width: 200px; overflow: hidden;padding-left: 2px;">
							<div><a data-bind="attr:{
								href: '#' + $data.properties['cmis:objectId'].value},
								text: $data.properties['cmis:name'].value"></a>

							</div>
							<a href="" class="pull-right" target="_blank" data-bind="attr: {title: cmis.readableFileSize($data.properties['cmis:contentStreamLength'].value),
							href: cmis.repo.rootFolderUrl+'?cmisselector=content&objectId=' + $data.properties['cmis:objectId'].value}">
							<i class="icon-2x icon-download-alt"></i>
							</a>
							<div>
								<i class="icon-user"></i>
								<span data-bind="text: $data.properties['cmis:lastModifiedBy'].value"></span>
							</div>
							<div>
								<span data-bind="text: cmis.readableFileSize($data.properties['cmis:contentStreamLength'].value)"></span>
							</div>
							<div>
								<span class="label" data-bind="text: $data.properties['cmis:versionLabel'].value"></span>
							</div>
						</div>

					</div>
					<!-- /ko -->
					<!-- ko if: sresults().hasMoreItems -->
					<div class="thumbnail pull-left" 
						style="height: 118px; width: 310px; margin-right: 10px; margin-bottom: 10px">
						<a style="padding: 10px;text-align:center;display:block;" 
							href="javascript:void(0)" data-bind="if: !searching()"
							onclick="cmis.nextSearchPage()">
							<i style="font-size: 80px" class="icon-forward"></i>
						</a>
						<!-- ko if: searching() -->
						<i style="font-size: 80px;text-align:center;display:block;"
						 class="icon-spinner icon-spin"></i>
						<!-- /ko -->
					</div>
					<!-- /ko -->
				</div>
			<hr/>
			</div>

		</div>

		<div class="row-fluid">
			<div class="span10">
				<ul class="breadcrumb" data-bind="foreach: pathElements">
				  <li data-bind="if: $index()+1!=$root.pathElements().length,
				  			css: {'active' : $index()+1==$root.pathElements().length}">
						<!-- ko if: $index-->
		        		<a data-bind="text: $data, 
		        			attr:{href:'#' + $root.pathElements().slice(0,$index()+1).join('/') }" >data</a>
		    			<!-- /ko -->            	
						<!-- ko ifnot: $index -->
		        		<a href="#" ><i class="icon-home"></i></a>
		    			<!-- /ko -->
		    			<span class="divider">/</span>
		    		</li>
					<li data-bind="if: $index()+1==$root.pathElements().length">
						<span data-bind="text:$data,css:{'icon-home':$index()==0}"></span>
		    			<!-- ko with: $root.children-->
		    			(<span data-bind="text: numItems"></span>)
		    			<!-- /ko -->
					</li>
				</ul>
			</div>
			<div class="span2">

				<div class="btn-group pull-right">
				  <a class="btn" href="javascript:void(0)"
				  	onclick="cmis.switchOrderDir()">
				    <i data-bind="css: {'icon-arrow-down':orderDir()=='asc',
				    'icon-arrow-up':orderDir()!='asc'}"></i>
				  </a>
				  <a class="btn dropdown-toggle" data-toggle="dropdown"
				     href="javascript:void(0)">
				    <span data-bind="text: order()[1]"></span>
				  </a>
				  <ul class="dropdown-menu">
				    <!-- ko foreach: orders() -->
						<li>
							<a href="javascript:void(0);" 
								data-bind="text:$data[1],
								click: function(){cmis.vm.order(this);}">
							</a>
						</li>
					<!-- /ko -->
				  </ul>
				</div>

			</div>
		</div>

		<div class="row-fluid">
			<div class="span3">
				<ul data-bind="template: { name: 'treenode', foreach: tree }"></ul>
 
				<script type="text/html" id="treenode">
				    <div>
				    	<a class="icon-folder-close" 
				    		href="javascript:void(0);" 
				    		data-bind="click: $root.toggleSubtree,
				    			css : {'icon-folder-close': !expanded(),
				    				'icon-folder-open' : expanded()}">
				    	</a>&nbsp;
				    	<a data-bind="text: name, attr: {href: '#' + path}"></a>
						<ul data-bind="template: { name: 'treenode', foreach: tree }"></ul>
				    </div>
				</script>

			</div>
			<div class="span9">
			<section data-bind="if: obj().properties['cmis:baseTypeId'].value() == 'cmis:document'">


				<div class="thumbnail" style="position:relative;"> 
				<canvas id="pdfArea"></canvas>
				<div class="btn-group" style="position:absolute;right:4px;" >
				  <a class="btn" href="javascript:void(0)"
				  	data-bind="visible: pdfjs"
				  	onclick="cmis.renderPDF(cmis.vm.obj().properties['cmis:objectId'].value(),document.getElementById('pdfArea'))">
					<i class="icon-2x icon-eye-open"></i>
				  </a>
				  <a class="btn" data-bind="attr:{href: window.location.href}">
					<i class="icon-2x icon-link"></i>
				  </a>
				  <a href="" class="btn" target="_blank" data-bind="attr: {title: cmis.readableFileSize(obj().properties['cmis:contentStreamLength'].value()),
					href: cmis.repo.rootFolderUrl+'?cmisselector=content&objectId=' + obj().properties['cmis:objectId'].value()}">
					<i class="icon-2x icon-download-alt"></i>
				</a>
				</div>
				<img data-bind="attr: {src: '/alfresco/service/api/node/'
						    	+ obj().properties['alfcmis:nodeRef'].value().replace(':/','')
						    	+ '/content/thumbnails/imgpreview?c=queue&ph=true'}" />
				</div>
				<table class="table table-hover" data-bind="foreach:_.keys(obj().properties)">
					<tbody>
						<!-- ko if: $data.indexOf('cmis:')==0 -->
							<tr data-bind="with: $root.obj().properties[$data]">
								<th data-bind="text: displayName"></th>
								<!-- ko if: type()=='datetime'-->
									<td data-bind="text: new Date(value())"></td>
								<!-- /ko -->
								<!-- ko if: type()!='datetime'-->
									<td data-bind="text: value"></td>
								<!-- /ko -->									
							</tr>
						<!-- /ko -->
					</tbody>
				</table>
			</section>


	    	<section data-bind="with:children">
	      		<div class="thumbnails">
	      			<!-- ko foreach: objects -->
	      			<div class="thumbnail pull-left" style="height: 118px; width: 310px; margin-right: 10px; margin-bottom: 10px" >
	      					<!-- ko if: object.properties['cmis:baseTypeId'].value() == 'cmis:document' -->
							<a class="pull-left" data-bind="attr:{
								href: '#' + $root.path() + object.properties['cmis:name'].value(),
								style: 'margin:4px; height: 100px; width: 100px; background: url(/alfresco/service/api/node/'
						    	+ object.properties['alfcmis:nodeRef'].value().replace(':/','')
						    	+ '/content/thumbnails/doclib?c=queue&ph=true) center no-repeat'}"
						    	>
							</a>
							<div style="width: 200px; overflow: hidden;padding-left: 2px;">
								<div><a data-bind="attr:{
								href: '#' + $root.path() + object.properties['cmis:name'].value()},
								text: object.properties['cmis:name'].value"></a>
								
								</div>
								<a href="" class="pull-right" target="_blank" data-bind="attr: {title: cmis.readableFileSize(object.properties['cmis:contentStreamLength'].value()),
									href: cmis.repo.rootFolderUrl+'?cmisselector=content&objectId=' + object.properties['cmis:objectId'].value()}">
										<i class="icon-2x icon-download-alt"></i>
								</a>
								<div>
									<i class="icon-user"></i>
									<span data-bind="text: object.properties['cmis:lastModifiedBy'].value()"></span>
								</div>
								<div>
									<span data-bind="text: cmis.readableFileSize(object.properties['cmis:contentStreamLength'].value())"></span>
								</div>
								<div>
									<span class="label" data-bind="text: object.properties['cmis:versionLabel'].value()"></span>
								</div>
							</div>
							<!-- /ko -->

	      					<!-- ko if: object.properties['cmis:baseTypeId'].value() != 'cmis:document' -->
							<a class="pull-left" data-bind="attr:{
								href: '#' + $root.path() + object.properties['cmis:name'].value(),
								style: 'padding:10px;margin:4px; height: 100px; width: 100px;'}"
						    	>
						    	<i style="font-size: 80px" class="icon-folder-close-alt"></i>
							</a>
								<a style="position:relative; top: 35px;" data-bind="attr:{
								href: '#' + $root.path() + object.properties['cmis:name'].value()},
								text: object.properties['cmis:name'].value"></a>
							<!-- /ko -->

	      			</div>
	      			<!-- /ko -->
	      			<!-- ko if: hasMoreItems -->
					<div class="thumbnail pull-left text-center" 
						style="height: 118px; width: 310px; margin-right: 10px; margin-bottom: 10px">
						<a style="padding: 10px;text-align:center;display:block;" 
							href="javascript:void(0)" data-bind="if: !$root.fetching()"
							onclick="cmis.nextChildrenPage()">
							<i style="font-size: 80px"  class="icon-forward" >
			    			</i>
						</a>
						<!-- ko if:$root.fetching -->
						<i style="font-size: 80px;text-align:center;display:block;" 
						 class="icon-spinner icon-spin"></i>
						<!-- /ko -->
					</div>
					<!-- /ko -->

				</div>
			</section>
			</div>
  		</div>
	  	<!-- /ko -->
	  	<!-- /ko -->

	  	<div class="row-fluid">
	  		<div class="span12">
	  			<hr/>
	  			<p style="text-align:center">
	  				<a class="btn" href="https://github.com/agea/Alfresco-HTML5-Client">
	  					<i class="icon-github-alt"></i>&nbsp; About
	  				</a> 

	  				<a data-bind="visible:loggedIn" class="btn" href="javascript:void(0)" onclick="cmis.logout()">
	  					<i class="icon-signout"></i>&nbsp; Logout
	  				</a> 

	  			</p>
	  		</div>
	  	</div>
	</div>

	<div class="init hero-unit" style="text-align:center">
		<i class="icon-spinner icon-spin"></i>&nbsp;Initializing
		<p class="muted" style="padding-top: 2em;">If you keep seeing this, something got wrong</p>
	</div>

	<script type="text/javascript">
		head.js('js/config.js', function(){
			head['js'].apply(window,config.scripts);					
		});
	</script>

</body>
</html>

